"use strict";var asyncHandler=require("express-async-handler"),AppError=require("../utils/AppError"),jwt=require("jsonwebtoken"),_require=require("util"),promisify=_require.promisify,User=require("../models/user"),_require2=require("../controller/userController"),getUsers=_require2.getUsers,isAuth=asyncHandler(function(r,e,s){var n,o,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("i"),console.log(r.headers.authorization),r.headers.authorization&&r.headers.authorization.startsWith("Bearer")&&(n=r.headers.authorization.split(" ")[1]),n||s(new AppError(" you are not logged in :please login",401)),e.next=6,regeneratorRuntime.awrap(promisify(jwt.verify)(n,process.env.SECRET_KEY));case 6:return o=e.sent,e.next=9,regeneratorRuntime.awrap(User.findById(o.userId));case 9:if((t=e.sent)||s(new AppError(" the user is not exist",401)),t.changedPasswordAfter(o.iat))return e.abrupt("return",s(new AppError("User Belong To This Token Recently Changed Password! Please Log In Again",401)));e.next=13;break;case 13:console.log("ekdhsdj"),console.log(t),r.user=t,s();case 17:case"end":return e.stop()}})});module.exports=isAuth;
//# sourceMappingURL=isAuth.min.js.map
