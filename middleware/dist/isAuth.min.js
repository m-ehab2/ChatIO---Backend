"use strict";var asyncHandler=require("express-async-handler"),AppError=require("../utils/AppError"),jwt=require("jsonwebtoken"),_require=require("util"),promisify=_require.promisify,User=require("../models/user"),isAuth=asyncHandler(function(r,e,n){var s,t,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r.headers.authorization&&r.headers.authorization.startsWith("Bearer")&&(s=r.headers.authorization.split(" ")[1]),s||n(new AppError(" you are not logged in :please login",401)),e.next=4,regeneratorRuntime.awrap(promisify(jwt.verify)(s,process.env.SECRET_KEY));case 4:return t=e.sent,e.next=7,regeneratorRuntime.awrap(User.findById(t.id));case 7:if((a=e.sent)||n(new AppError(" the user is not exist",401)),a.changedPasswordAfter(t.iat))return e.abrupt("return",n(new AppError("User Belong To This Token Recently Changed Password! Please Log In Again",401)));e.next=11;break;case 11:r.user=a,n();case 13:case"end":return e.stop()}})});module.exports=isAuth;
//# sourceMappingURL=isAuth.min.js.map
