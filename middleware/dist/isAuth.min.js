"use strict";var asyncHandler=require("express-async-handler"),AppError=require("../utils/AppError"),jwt=require("jsonwebtoken"),_require=require("util"),promisify=_require.promisify,User=require("../models/user"),_require2=require("../controller/userController"),getUsers=_require2.getUsers,isAuth=asyncHandler(function(r,e,s){var t,n,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r.headers.authorization&&r.headers.authorization.startsWith("Bearer")?t=r.headers.authorization.split(" ")[1]:r.cookies.jwt&&(t=r.cookies.jwt),t||s(new AppError(" you are not logged in :please login",401)),e.next=4,regeneratorRuntime.awrap(promisify(jwt.verify)(t,process.env.SECRET_KEY));case 4:return n=e.sent,e.next=7,regeneratorRuntime.awrap(User.findById(n.userId));case 7:if((o=e.sent)||s(new AppError(" the user is not exist",401)),o.changedPasswordAfter(n.iat))return e.abrupt("return",s(new AppError("User Belong To This Token Recently Changed Password! Please Log In Again",401)));e.next=11;break;case 11:console.log("ekdhsdj"),console.log(o),r.user=o,s();case 15:case"end":return e.stop()}})});module.exports=isAuth;
//# sourceMappingURL=isAuth.min.js.map
