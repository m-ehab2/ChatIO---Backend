{"version":3,"sources":["isAuth.js"],"names":["asyncHandler","require","AppError","promisify","getUsers","jwt","req","res","next","token","decoded","user","regeneratorRuntime","async","_context","prev","console","log","authorization","headers","startsWith","split","awrap","verify","process","env","SECRET_KEY","sent","User","findById","userId","iat","abrupt","stop","module","exports","isAuth"],"mappings":"aAAA,IAAMA,aAAeC,QAAQ,yBACvBC,SAAWD,QAAQ,qBADnBD,IAAAA,QAAY,yBAGAC,QAAQ,QAAnBE,mBAAAA,UAFDD,KAAQD,QAAGA,4BAIIA,QAAQ,gCAArBG,mBAAAA,SAHFC,OAAIJ,aAAQ,SAAlBK,EAAAC,EAAAC,GAAkB,IAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAN,MAAA,KAAA,EAAA,OAKdQ,QAAQC,IAAI,KACZD,QAAQC,IALMhB,EAAAA,QAAQiB,eAOlBZ,EAAIa,QAAQD,eAAiBZ,EAAIa,QAAQD,cAAcE,WAAW,YANhEX,EAAGR,EAAQkB,QAAAD,cAArBG,MAAA,KAAA,IACQjB,GAUAI,EAAK,IAAIN,SAAS,uCAAuC,MAb/CY,EAAAN,KAAA,EAAAI,mBAAAU,MAIUnB,UAAAE,IAAAkB,OAAApB,CAAAM,EAAAe,QAAAC,IAAAC,aAJV,KAAA,EAAA,OAIUhB,EAJVI,EAAAa,KAAAb,EAAAN,KAAA,EAAAI,mBAAAU,MAIUM,KAAAC,SAAAnB,EAAAoB,SAJV,KAAA,EAAA,IAIUnB,EAJVG,EAAAa,OAIUnB,EAAA,IAAAN,SAAA,yBAAA,MACxBc,EAAAA,qBAAAN,EAAAqB,KALc,OAAAjB,EAAAkB,OAAA,SAMdhB,EAgBQ,IAAId,SAdRI,2EACCG,OATSK,EAAAN,KAAA,GAAA,MAAA,KAAA,GAaVA,QAAAA,IAAI,WACPQ,QAAAC,IAAAN,GAgBGL,EAAIK,KAAOA,EA1BSH,IAJV,KAAA,GAAA,IAAA,MAAA,OAAAM,EAAAmB,YAiClBC,OAAOC,QAAQC","file":"isAuth.min.js","sourcesContent":["const asyncHandler = require('express-async-handler');\r\nconst AppError = require('../utils/AppError');\r\nconst jwt=require('jsonwebtoken')\r\nconst {promisify}=require('util');\r\nconst User = require('../models/user');\r\nconst { getUsers } = require('../controller/userController');\r\nconst isAuth = asyncHandler(async (req, res, next) => {\r\n    console.log(\"i\")\r\n    console.log(req.headers.authorization)\r\n    let token \r\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\r\n         token = req.headers.authorization.split(' ')[1];\r\n    }\r\n    \r\n    if (!token) {\r\n        next(new AppError(\" you are not logged in :please login\",401))\r\n    }\r\n    const decoded = await promisify(jwt.verify)(token, process.env.SECRET_KEY)\r\n    const user = await User.findById(decoded.userId);\r\n    if (!user) {\r\n        next(new AppError(\" the user is not exist\",401))\r\n    }\r\n    if (user.changedPasswordAfter(decoded.iat)) {\r\n        return next(\r\n            new AppError(\r\n                'User Belong To This Token Recently Changed Password! Please Log In Again',\r\n                401\r\n            )\r\n        );\r\n    }\r\n    console.log(\"ekdhsdj\")\r\n    console.log(user)\r\n        req.user = user;\r\n    next()\r\n})\r\nmodule.exports=isAuth"]}