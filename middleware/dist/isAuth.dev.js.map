{"version":3,"sources":["isAuth.js"],"names":["asyncHandler","require","AppError","jwt","promisify","User","isAuth","req","res","next","headers","authorization","startsWith","token","split","verify","process","env","SECRET_KEY","decoded","findById","id","user","changedPasswordAfter","iat","module","exports"],"mappings":";;AAAA,IAAMA,YAAY,GAAGC,OAAO,CAAC,uBAAD,CAA5B;;AACA,IAAMC,QAAQ,GAAGD,OAAO,CAAC,mBAAD,CAAxB;;AACA,IAAME,GAAG,GAACF,OAAO,CAAC,cAAD,CAAjB;;eACkBA,OAAO,CAAC,MAAD,C;IAAlBG,S,YAAAA,S;;AACP,IAAMC,IAAI,GAAGJ,OAAO,CAAC,gBAAD,CAApB;;AACA,IAAMK,MAAM,GAAEN,YAAY,CAAE,iBAAOO,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAExB,cAAIF,GAAG,CAACG,OAAJ,CAAYC,aAAZ,IAA6BJ,GAAG,CAACG,OAAJ,CAAYC,aAAZ,CAA0BC,UAA1B,CAAqC,QAArC,CAAjC,EAAiF;AAC5EC,YAAAA,KAAK,GAAGN,GAAG,CAACG,OAAJ,CAAYC,aAAZ,CAA0BG,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,CAAR;AACJ;;AAED,cAAI,CAACD,KAAL,EAAY;AACRJ,YAAAA,IAAI,CAAC,IAAIP,QAAJ,CAAa,sCAAb,EAAoD,GAApD,CAAD,CAAJ;AACH;;AARuB;AAAA,0CASFE,SAAS,CAACD,GAAG,CAACY,MAAL,CAAT,CAAsBF,KAAtB,EAA6BG,OAAO,CAACC,GAAR,CAAYC,UAAzC,CATE;;AAAA;AASlBC,UAAAA,OATkB;AAAA;AAAA,0CAULd,IAAI,CAACe,QAAL,CAAcD,OAAO,CAACE,EAAtB,CAVK;;AAAA;AAUlBC,UAAAA,IAVkB;;AAWxB,cAAI,CAACA,IAAL,EAAW;AACPb,YAAAA,IAAI,CAAC,IAAIP,QAAJ,CAAa,wBAAb,EAAsC,GAAtC,CAAD,CAAJ;AACH;;AAbuB,eAcpBoB,IAAI,CAACC,oBAAL,CAA0BJ,OAAO,CAACK,GAAlC,CAdoB;AAAA;AAAA;AAAA;;AAAA,2CAebf,IAAI,CACP,IAAIP,QAAJ,CACI,0EADJ,EAEI,GAFJ,CADO,CAfS;;AAAA;AAsBpBK,UAAAA,GAAG,CAACe,IAAJ,GAAWA,IAAX;AACJb,UAAAA,IAAI;;AAvBoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAF,CAA1B;AAyBAgB,MAAM,CAACC,OAAP,GAAepB,MAAf","sourcesContent":["const asyncHandler = require('express-async-handler');\r\nconst AppError = require('../utils/AppError');\r\nconst jwt=require('jsonwebtoken')\r\nconst {promisify}=require('util');\r\nconst User = require('../models/user');\r\nconst isAuth =asyncHandler( async (req, res, next) => {\r\n    let token \r\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\r\n         token = req.headers.authorization.split(' ')[1];\r\n    }\r\n    \r\n    if (!token) {\r\n        next(new AppError(\" you are not logged in :please login\",401))\r\n    }\r\n    const decoded = await promisify(jwt.verify)(token, process.env.SECRET_KEY)\r\n    const user = await User.findById(decoded.id);\r\n    if (!user) {\r\n        next(new AppError(\" the user is not exist\",401))\r\n    }\r\n    if (user.changedPasswordAfter(decoded.iat)) {\r\n        return next(\r\n            new AppError(\r\n                'User Belong To This Token Recently Changed Password! Please Log In Again',\r\n                401\r\n            )\r\n        );\r\n    }\r\n        req.user = user;\r\n    next()\r\n})\r\nmodule.exports=isAuth"],"file":"isAuth.dev.js"}