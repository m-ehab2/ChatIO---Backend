"use strict";var asyncHandler=require("express-async-handler"),Message=require("../models/message"),User=require("../models/user"),Chat=require("../models/chat");exports.sendMessage=asyncHandler(function(a,t){var s,r,n,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.body,r=s.content,n=s.chatId,e.next=3,regeneratorRuntime.awrap(Message.create({sender:a.user.id,content:r,chat:n}));case 3:return c=e.sent,console.log(c),e.next=7,regeneratorRuntime.awrap(Message.populate(c,{path:"sender",select:"name image"}));case 7:return c=e.sent,console.log(c+"bhbh"),e.next=11,regeneratorRuntime.awrap(Message.populate(c,{path:"chat"}));case 11:return c=e.sent,console.log(c+"nb"),e.next=15,regeneratorRuntime.awrap(User.populate(c,{path:"chat.users",select:"name image email"}));case 15:return c=e.sent,e.next=18,regeneratorRuntime.awrap(Chat.findByIdAndUpdate(n,{latestMessage:c}));case 18:console.log(c+"nb"),t.status(201).json({status:"success",data:c});case 20:case"end":return e.stop()}})}),exports.getMessages=asyncHandler(function(a,t){var s,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.params.chatId,e.next=3,regeneratorRuntime.awrap(Message.find({chat:s}).populate("chat").populate("sender","name image email"));case 3:r=e.sent,t.status(200).json({status:"success",data:r});case 5:case"end":return e.stop()}})});
//# sourceMappingURL=messageController.min.js.map
