{"version":3,"sources":["chatController.js"],"names":["asyncHandler","require","Chat","User","AppError","exports","accessChat","req","res","next","console","log","userId","body","find","$and","users","$elemMatch","$eq","user","_id","populate","chatData","path","select","length","status","json","data","newChat","chatName","isGroupChat","create","createChat","findOne","fullChat","fetchChats","sort","updatedAt","then","results","chats"],"mappings":"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","sourcesContent":["\r\nconst asyncHandler = require('express-async-handler');\r\nconst Chat = require('../models/chat');\r\nconst User = require('../models/user');\r\nconst AppError = require('../utils/AppError');\r\nexports.accessChat = asyncHandler(async (req, res, next) => {\r\n    console.log(\"in chat\")\r\n    const { userId } = req.body;\r\n    let chatData = await Chat.find({\r\n        $and: [\r\n            { users: { $elemMatch: { $eq: req.user._id } } },\r\n            { users: { $elemMatch: { $eq: userId } } },\r\n        ]\r\n    }).populate(\"users\", \"-password\").populate('message');\r\n    chatData = await User.populate(chatData, {\r\n        path: 'message.sender',\r\n        select:'name image email'\r\n    })\r\n    if (chatData.length>0) {      \r\n        res.status(200).json({\r\n            status: \"success\",\r\n            data:chatData[0]\r\n        })\r\n    } else {\r\n        var newChat = {\r\n            users: [req.user._id, userId],\r\n            chatName: \"sender\",\r\n            isGroupChat:false\r\n        }\r\n        const createChat = await Chat.create(newChat);\r\n\r\n        const fullChat = await Chat.findOne({ _id: createChat._id })\r\n            .populate(\"users\", \"-password\");\r\n        if (!fullChat) {\r\n            throw new AppError(\"the chat not exist\",400)\r\n        }\r\n        res.status(201).json({\r\n            status: \"success\",\r\n            data:fullChat\r\n        })\r\n    }\r\n})\r\nexports.fetchChats = asyncHandler(async (req, res, next) => {\r\n         await Chat.find({ users: { $elemMatch: { $eq: req.user._id } } })\r\n        .populate('users', \"-password\")\r\n        .populate('groupAdmin', '-password')\r\n        .populate('message')\r\n        .sort({ updatedAt: -1 }).\r\n        then(async(results) => {\r\n            results=await User.populate(results, {\r\n                path: 'message.sender',\r\n                select:'name image email'\r\n            })\r\n            res.status(200).json({\r\n                status: \"success\",\r\n                data:results\r\n            })\r\n        })\r\n    next(new AppError('not found any chats for that user',400))\r\n    console.log(chats)\r\n\r\n})\r\n"],"file":"chatController.dev.js"}